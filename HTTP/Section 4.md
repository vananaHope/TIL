# Section 4 HTTP 메서드

## HTTP API를 만들어보자
* 요구사항 ( 단순하게 생각해서 초보 개발자가 만들었을 때 )
  * 회원 목록 조회 /read-member-list
  * 회원 조회 /read-member-by-id
  * 회원 등록 /create-member
  * 회원 수정 /update-member
  * 회원 삭제 /delete-member

---> **리소스가 식별되지 않기 때문에 잘못된 설계**
  
* **API URI를 설계할 때는 리소스와 행위를 분리해야한다!!**
* 리소스의 의미는 무엇인가?
  * 회원 등록,삭제,수정을 하는 행위는 리소스가 아니다.
  * EX) 강의를 수강해라 ---> "강의"가 리소스
  * 회원이라는 개념이 리소스에 해당한다.
  * 따라서 회원을 등록,수정,삭제하는 행위는 모두 배제하고 리소스만 식별한다.
* 리소스 식별, 계층 구조를 통해 설계
  * 회원 목록 조회 /members
  * 회원 조회 /members/{id} 
  * 회원 등록 /members/{id}
  * 회원 수정 /members/{id}
  * 회원 삭제 /members/{id}

* 조회,등록,수정,삭제 모두 동일한데 어떻게 구분해야 하는가? **HTTP 메서드를 활용!**

## HTTP 메서드
### 메서드 종류
* 주요 메서드 
  * GET: 리소스 조회
  * POST: 요청 데이터 처리, 주로 등록에 사용한다.
  * PUT: 리소스를 대체하며 해당 리소스가 없으면 생성한다.
  * PATCH: 리소스 부분 변경
  * DELETE: 리소스 삭제

### HTTP 메서드 - GET
* GET
  * 주로 조회하는 데 사용된다.
  * 메시지 바디를 사용할 수 있지만 지원하지 않는 곳이 많아 권장하지 않는다.
  * 서버에 전달하고자 하는 데이터는 쿼리 파라미터, 쿼리 스트링을 통해 전달한다.

<img src ="https://user-images.githubusercontent.com/125250099/220264434-93937d68-fac1-4c24-b23a-e5dc52d4ec54.png" width="60%">

### HTTP 메서드 - POST
* POST
  * 요청 데이터를 처리
  * 메시지 바디를 통해 서버로 요청 데이터 전달
  * 서버는 요청 데이터를 처리한다.
    * 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.
  * 전달된 데이터를 신규 등록이나 프로세스 처리에 주로 사용된다.
* 리소스 등록 - 메시지 전달

<img src="https://user-images.githubusercontent.com/125250099/220265910-20cd5647-b5b8-4c86-8ae6-afb957e30ad8.png" width="60%">

* 리소스 등록 - 신규 리소스 생성

<img src ="https://user-images.githubusercontent.com/125250099/220266086-bce682be-fbfb-49ff-8aef-58d46770ba51.png" width="60%">

* 리소스 등록 - 응답 데이터

<img src ="https://user-images.githubusercontent.com/125250099/220266348-1dd3b293-ad71-4ced-9799-7b4824e0c84e.png" width="60%">

* POST는 데이터를 어떻게 처리하는가?
  * 스펙: POST 메서드는 대상 리소스의 고유한 의미 체계에 따라 포함된 표현을 처리하도록 요청한다. 
  * HTML양식에 입력 된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공. EX) HTML 폼에서 회원 가입 및 주문
  * 게시판, 뉴스 그룹, 블로그 또는 유사한 기사 그룹에 메시지 게시 EX) 게시판 글쓰기, 댓글 달기
  * 서버가 아직 식별하지 않은 새 리소스 생성 EX) 신규 주문 생성
  * 기존 자원에 데이터 추가 EX) 한 문서 끝에 내용 추가하기

**이 리소스 URI에 POST 요청이 오면 어떻게 처리할 지를 리소스마다 정해야 한다.**

**정리**
* 새 리소스 등록
  * 서버가 등록하지 않은 리소스를 생성
* 요청 데이터 처리
  * 단순히 데이터를 처리하거나 변경하는 것을 넘어 프로세스를 처리하는 경우
    * 결제완료 ---> 배달 시작 ---> 배달 완료 / 값 변경을 넘어 프로세스 상태가 변경되는 경우
  * POST의 결과로 새 리소스가 생성되지 않을 수도 있다.
    * POST /order/{orderId}/start-delivery (컨트롤 URI)
  * 다른 메서드로 처리하기 애매한 경우
    * 애매하면 POST를 사용하자!

### HTTP 메서드 - PUT,PATCH,DELETE
* PUT 
  * 리소스를 대체하는 메서드로 리소스가 있으면 대체하고 없으면 새로 생성한다. ( 덮어쓰기 )
  * **클라이언트가 리소스를 식별해야한다. ( 리소스의 위치를 알고 URI를 지정 )**
  * EX) PUT/members/100 HTTP1.1 , Location을 알아야한다.
  * 완전히 대체하기 때문에 서버에 리소스가 있더라고 클라이언트에서 보낸 데이터로 완전히 바뀐다. 따라서, 부분적으로 바꾸기 위해서는 PATCH를 사용해야한다.

* PATCH
  * 리소스를 부분적으로 변경한다.

<img src ="https://user-images.githubusercontent.com/125250099/220300140-dc318993-0fc4-4a84-8866-d12ef6106819.png" width="60%">

* DELETE
  * 리소스를 제거한다.

### HTTP 메서드의 속성
* 안전 ( Safe )
  * 호출해도 리소스를 변경하지 않는다.
  * 계속 호출해서 로그가 쌓여서 장애가 발생하는 경우에는? ---> 안전은 해당 리소스만 신경쓰고 다른 것은 신경 쓰지 않는다.
  * GET은 리소스를 변경하지 않기 때문에 안전하다.
  * PUT,PATCH,DELETE,POST는 리소스를 변경하므로 안전하지 않다.

* 멱등 ( Idempotent )
  * 메서드를 여러번 호출해도 결과가 같아야 한다.
  * 멱등 메서드
    * GET: 여러 번 조회해도 결과값은 동일하다.
    * PUT: 결과를 대체한다. 따라서 여러 번 호출해도 최종 결과는 같다.
    * DELETE: 결과를 삭제한다. 따라서 여러 번 호출해도 최종 결과는 같다.
    * POST: **멱등이 아니다** 두 번 호출하면 중복이 되기 때문에 에러가 발생할 수 있다. ---> 중복결제
  * 어떻게 활용할 수 있는가?
    * 자동 복구 메커니즘
    * 서버가 TIMEOUT으로 응답하지 못해도 클라이언트에서 같은 요청을 다시할 수 있다.
  * 멱등은 외부 요인을 고려하지 않는다.
    * 내가 회원정보를 조회를 다시 할 때 그 사이에 다른 클라이언트의 요청으로 해당 회원정보가 변경되서 조회 결과가 달라지는 것은 고려하지 않는다.

* 캐시가능 ( Cacheable )
  * 응답 결과를 캐시해서 사용해도 될까?
  * GET,HEAD,POST,PATCH 캐시 가능
  * 하지만 GET,HEAD정도만 캐시를 사용한다.
    * POST,PATCH의 경우 본문 내용도 캐시 키로 고려해야 하는데 구현이 쉽지 않다.
  * GET은 URL만 캐시키로 설정하면 되므로 구현이 쉽다.

    
    
